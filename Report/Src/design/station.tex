%!TEX root = ../../main.tex
\subsection{Station Software}\label{subsec:stationsoftdesfgi}
While \figref{fig:overallarch} of the overall architecture provides an overview of the system, the station component has its own architecture as well, which can be seen in \figref{fig:stationarch}. In this figure the arrows represent flow of information.

\begin{figure}[h]
	\centering
	\includegraphics[trim=2cm 9.5cm 0cm 3cm, clip, scale=0.7]{design/station}
	\caption{Station software architecture.}\label{fig:stationarch}
\end{figure}

In this figure, the station is responsible for the GUI.
\texttt{TCPListener} is running in a thread and has the responsibility of listening for messages from the global system through the \texttt{Website\-ToStationNotifier} and stores these messages as a \texttt{NetworkData} object, and tells this object to perform the action the message contains.

The \texttt{NetworkData} area has the responsibility of adding a booking to the local database corresponding to the information the object contains or removing a booking with the ID it received.

The \texttt{LockManager} area is running in a thread, and is responsible for locking a bicycle when a booking is close to its start time and unlocking said bicycle again if the booking's start time is exceeded by a certain limit.

The \texttt{ServiceThreads} area also running in a separate thread.
This thread is responsible for reporting changes at the station, which are stored in the \texttt{ActionQueue} queue.
As soon as there is something in the \texttt{ActionQueue} queue, the thread tries to report it to the online interface, repeating until it succeeds in transmitting it.

How locking should be tackled has not been touched upon yet, specifically when docks should be locked.
It is, however, a central part of the system and as such is examined hereafter.
The lock mechanism cannot be left as a responsibility of the database as the goal is to make the system less static, as requested by Aalborg Kommune, see \secref{subsec:meetingaalborg}.
If we were to make this a responsibility of the database, it would mean that the locking should be performed immediately, but if you book a bicycle for tomorrow that would mean a bicycle would be unavailable for other users for a whole day, which is highly undesired.
An alternative would be to limit the time in advance you can make a booking, this would also increase the dynamic of the system, but would limit the booking flexibility.
This is a trade off between certainty of getting the bicycle booked and a dynamic system where more bicycles are in use.
It is chosen that the dock should be locked one hour in advance of a booking, risking that not all bookings will have a bicycle locked for it.
Bookings having earlier start time are prioritised, if two or more bookings have equal start time they are prioritised according to registration time.