\section{Usage History for Business Intelligence Purposes}
This section will describe various usage history features that were implemented, and why. It includes the GPS History.

\subsection{GPS History}
The system saves the location of bicycles registered in the system, which could be helpful for determining where bicycles currently are. 
This would allow the 'county' to determine where 'lost' bicycles are, which in turn would allow for easier recovery of bicycles.
Having this already implemented, it makes sense to store the GPS coordinates in a separate table for historical and business intelligence purposes.
This kind of historical data could be interesting for intelligence purposes because it would allow knowledge about the following:

\begin{description}
\item[Which routes are used?] If routes could be determined, patterns could possibly be seen, e.g. if there is a particular route that is very popular.
\item[Are there hotspots for bicycles?] If positions of bicycles could be determined, it would mean that hotspots(places where there is a lot of bicycle activity) could be found. This could provide valuable knowledge about for example where to add new stations.
\end{description}

Which is why a table about the historical location of bicycles was added with the following structure,

\begin{itemize}
\item The ID of the Bicycle
\item A timestamp of when the coordinates was recorded.
\item The latitude and the longitude.
\end{itemize}

\fxwarning{Er det nok? Ville det ikke vÃ¦re dejligt hvis man kunne se information om hvilken booking det nu engang er det GPS signal/tilhÃ¸rer.}

At the same time when location is recorded temporarily from a service, it needs to also record it permanently in the global database, the code to do this can be seen in \lstref{lst:registergps} on lines 10--14, to read more about services see \secref{sec:interfaces}.

\begin{lstlisting}[language=PHP, caption={The function that records the location of a bicycle.}, label=lst:registergps]
function RegisterGPS($bicycle_id, $latitude, $longitude)
{
    global $db;
    
    $stmt = $db->prepare("UPDATE bicycle SET latitude = ?, longitude = ? WHERE bicycle_id = ?");
    $stmt->bind_param("ddi", $latitude, $longitude, $bicycle_id);
    $stmt->execute();
    $stmt->close();
    
    $stmt = $db->prepare("INSERT INTO historylocationbicycle(bicycle_id, latitude, longitude) VALUES (?,?,?)");
    $stmt->bind_param("idd", $bicycle_id, $latitude, $longitude);
    $stmt->execute();
    $stmt->close();
    return true;
}
\end{lstlisting}